#!/bin/sh
#                               configure script
# 
# This file was developed by Reid Spencer and is distributed under the
# University of Illinois Open Source License. See LICENSE.TXT for details.
# 
#===------------------------------------------------------------------------===#
# This script allows LLVM modules to be configured including processing 
# dependencies and optional configuration parameters. Use it like this:
#
#    cd llvm-top
#    ./configure {module_names} {configure_options}
#
# where:
#    {module_names} is a list of modules you want to configure (e.g. llvm, hlvm)
#    {configure_options} is any options you want to pass to *all* the modules
#      when they run their configure commands
#
# Note that the script will checkout and configure any dependent modules as well
# as the ones specified in {module_names} so it is only necessary to specify the
# minimal set you're interested in.

# Get the library code
. ./library.sh

# Process the arguments so that anything starting with - is passed down to the
# configure scripts while anything else is a module name. Collect the arguments
# in appropriate variables for later use.
for arg in "$@" ; do 
  case "$arg" in
    -*)
      CONFIGURE_ARGS="$CONFIGURE_ARGS $arg"
      ;;
    *)
      MODULE_NAMES="$MODULE_NAMES $arg"
  esac
done

# Get (and possibly check out) the set of modules and their dependencies. This
# sets the MODULE_DEPENDENCIES variable to the set of module names that should
# be configured, in the correct order (least dependent first, no duplicates).
MODULE_DEPENDENCIES=""
get_dependencies $MODULE_NAMES

# Now that we have a list of dependent modules, we must configure each of them
# according to the specifications of the module.
for mod in $MODULE_DEPENDENCIES ; do
  configure_module "$mod" "$CONFIGURE_ARGS"
done

# Just indicate what modules we configured
echo Modules configured:"$MODULE_DEPENDENCIES".
