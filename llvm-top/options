#!/bin/sh
#                               options script 
# 
# This file was developed by Reid Spencer and is distributed under the
# University of Illinois Open Source License. See LICENSE.TXT for details.
# 
#===------------------------------------------------------------------------===#

# This script lets you set sticky options that can be set once with this command
# and then ignored for remaining commands used from the same directory. 

# Include the library. This will either read the options from the .options
# file or it will set the variables to their default values.
. ./library.sh

# Process the arguments to set the new values
msg 3 "Processing new option arguments"
for arg in "$@" ; do
  case "$arg" in
    LLVM_TOP=*)     LLVM_TOP=`echo "$arg" | sed -e 's/LLVM_TOP=//'` ;;
    PREFIX=*)       PREFIX=`echo "$arg" | sed -e 's/PREFIX=//'` ;;
    DESTDIR=*)      DESTDIR=`echo "$arg" | sed -e 's/DESTDIR=//'` ;;
    VERBOSE=*)      VERBOSE=`echo "$arg" | sed -e 's/VERBOSE=//'` ;;
    TOOL_VERBOSE=*) TOOL_VERBOSE=`echo "$arg" | sed -e 's/TOOL_VERBOSE=//'` ;;
    SHARED_LIBS=*)  SHARED_LIBS=`echo "$arg" | sed -e 's/SHARED_LIBS=//'` ;;
    ARCHIVE_LIBS=*) ARCHIVE_LIBS=`echo "$arg" | sed -e 's/ARCHIVE_LIBS=//'` ;;
    OPTIMIZED=*)    OPTIMIZED=`echo "$arg" | sed -e 's/OPTIMIZED=//'` ;;
    DEBUG=*)        DEBUG=`echo "$arg" | sed -e 's/DEBUG=//'` ;;
    ASSERTS=*)      ASSERTS=`echo "$arg" | sed -e 's/ASSERTS=//'` ;;
    EXPENSIVE=*)    EXPENSIVE=`echo "$arg" | sed -e 's/EXPENSIVE=//'` ;;
    PROFILING=*)    PROFILING=`echo "$arg" | sed -e 's/PROFILING=//'` ;;
    USEOBJDIR=*)    USEOBJDIR=`echo "$arg" | sed -e 's/USEOBJDIR=//'` ;;
    STRIP=*)        STRIP=`echo "$arg" | sed -e 's/STRIP=//'` ;;
    OPTFORSIZE=*)   OPTFORSIZE=`echo "$arg" | sed -e 's/OPTFORSIZE=//'` ;;
               *)   die 1 "Unrecognized option: $arg" ;;
  esac
done

# Write the new options set to the .options file
msg 3 "Write options to .options file"
cat <<__EOF__ > "$options"
# LLVM configuration options database.
# This script is generated by "options" and included into library.sh
LLVM_TOP="$LLVM_TOP"
PREFIX="$PREFIX"
DESTDIR="$DESTDIR"
VERBOSE="$VERBOSE"
TOOL_VERBOSE="$TOOL_VERBOSE"
SHARED_LIBS="$SHARED_LIBS"
ARCHIVE_LIBS="$ARCHIVE_LIBS"
OPTIMIZED="$OPTIMIZED"
DEBUG="$DEBUG"
ASSERTS="$ASSERTS"
EXPENSIVE="$EXPENSIVE"
PROFILING="$PROFILING"
USEOBJDIR="$USEOBJDIR"
STRIP="$STRIP"
OPTFORSIZE="$OPTFORSIZE"
__EOF__

# If there were no arguments, just print the options for the user
msg 3 "Printing options"
if test "$#" -eq 0 ; then
  cat "$options" | grep "="
fi

